{% extends "base.html" %}

{% block content %}
 <!--begin::App Content Header-->

        <div class="app-content">
          <!--begin::Container-->
          <div class="container-fluid">

              <div class="row login-nav-item" style="display:none;">

              <div  style="margin:30px 0px 10px 0px;">
              <div class="col-sm-6"><h4 class="mb-0">管理面版</h4></div>
              </div>

              <!--begin::Col-->
              <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 1-->
                <div class="small-box layui-bg-blue layui-bg-touyan"  >
                  <div class="inner"  style="text-align:center;">
                    <h3 id="total_twitter" >0</h3>
                    <p>推特账号</p>
                  </div>

                  <a href="{{ url_for('twitter.index') }}" class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover">
                    去管理推特账号 <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 1-->
              </div>
              <!--end::Col-->
              <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 2-->
                <div class="small-box  layui-bg-blue layui-bg-touyan"   >
                  <div class="inner"  style="text-align:center;">
                    <h3 id="total_twitter_category" >0</h3>
                    <p>推特分组</p>
                  </div>

                  <a href="{{ url_for('category.twitter') }}" class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover">
                   去管理推特分组 <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 2-->
              </div>
              <!--end::Col-->
              <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 3-->
                <div class="small-box layui-bg-green  layui-bg-touyan"  >
                  <div class="inner"  style="text-align:center;">
                    <h3 id="total_discord" >0</h3>
                    <p>Discord账号</p>
                  </div>

                  <a href="{{ url_for('discord.index') }}" class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover">
                    去管理Discord账号 <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 3-->
              </div>
              <!--end::Col-->
              <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 4-->
                <div class="small-box layui-bg-green  layui-bg-touyan" >
                  <div class="inner"  style="text-align:center;">
                    <h3 id="total_twitter_discord" >0</h3>
                    <p>Discord分组</p>
                  </div>

                  <a href="{{ url_for('category.discord') }}" class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover">
                    去管理Discord分组 <i class="bi bi-link-45deg"></i>
                  </a>
                </div>
                <!--end::Small Box Widget 4-->
              </div>
              <!--end::Col-->
            </div>


            <!--begin::Row-->
            <div  style="margin:20px 0px 10px 0px;">
              <div class="col-sm-6"><h4 class="mb-0">投研工具箱</h4></div>


            </div>
            <!--end::Row-->

              <div class="tool-card-grid" id="data-table">





              </div>


<style>
.tool-card-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}

.tool-card {
  max-width: 300px;
  display: flex;
  color: #16b777;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  text-decoration: none;
  transition: box-shadow 0.2s ease;
  box-sizing: border-box;
  overflow: hidden;
  padding: 16px; /* 增加上下左右空间 */
  align-items: center; /* 垂直居中图标和文字 */
}

.tool-card:hover {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.tool-card-icon-wrap {
  flex: 2;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 12px;
  box-sizing: border-box;
}

.tool-card-icon {
  width: 48px;
  height: 48px;
  object-fit: contain;
}

.tool-card-body {
  flex: 8;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding-right: 12px;
  box-sizing: border-box;
}

.tool-card-title {
  font-size: 14px;
  font-weight: 700;
  margin-bottom: 8px;
}

.tool-card-sub {
  font-size: 12px;
  color: #666;
  line-height: 1.5;
}
</style>


          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content-->

<script>
var laypage = layui.laypage;
var $ = layui.jquery;

$(document).ready(function() {
    const token = localStorage.getItem('token');

     $.ajax({
      url: '/api/get_total_info',
      method: 'GET',
      headers: {
            'Authorization': 'Bearer ' + token
      },
      success: function(res) {
        if (res.status === 1) {
          $("#total_twitter").text(res.data.twitter_count)
          $("#total_twitter_category").text(res.data.twitter_category_count)
          $("#total_discord").text(res.data.discord_count)
          $("#total_twitter_discord").text(res.data.discord_category_count)

        } else {
          console.log('权限不足');
        }
      },
      error: function() {
        console.log('接口请求失败');
      }
    });



  function fetchData(page, limit) {
    $.ajax({
      url: '{{ url_for('website.page') }}',  // 替换为你的后端接口
      type: 'GET',
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
      },
      data: { page: page, limit: limit,is_type: 2 },
      success: function(res) {
        // 假设 res 格式：{ code: 0, count: 100, data: [...] }
        if (res.code === 0) {
          renderTable(res.data);  // 渲染表格
          laypage.render({
            elem: 'demo-laypage-all',
            count: res.count,
            limit: limit,
            curr: page,
            layout: ['count', 'prev', 'page', 'next', 'limit', 'skip'], // 功能布局
            jump: function(obj, first) {
              if (!first) {
                fetchData(obj.curr, obj.limit);  // 重新获取数据
              }
            }
          });
        }else{
            $('#data-table').html("<暂无数据>");
        }
      }
    });
  }

  function renderTable(data) {
    var html = '';
    const colorClasses = [
      'layui-bg-orange',
      'layui-bg-green',
      'layui-bg-blue',
      'layui-bg-black'
    ];

    data.forEach(function(item) {
      // 随机选择一个 class
      const randomClass = colorClasses[Math.floor(Math.random() * colorClasses.length)];
      html += ` <a href="${item.url}" target="_blank" class="tool-card">
                    <div class="tool-card-icon-wrap">
                      <img src="${item.logo}" class="tool-card-icon" alt="icon" />
                    </div>
                    <div class="tool-card-body">
                      <div class="tool-card-title">${item.title}</div>
                      <div class="tool-card-sub">${item.description}</div>
                    </div>
                  </a>`;
    });
    $('#data-table').html(html);
  }

  //加载最新关注数据
  setTimeout(() => {
     fetchData(1, 100);  // 默认加载第1页，10条数据
  }, 250);



});
</script>
{% endblock %}